<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>SSH Expert :: RedFou52 - BlogPost â€” Welcome to my BlogPost</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="This tutorial is not going to teach you how to use SSH but more to show you some tips to improve your life.
 Keygen # generate Private and Public key ~ ç«ˆé–€Â» shh-keygen -t &amp;lt;algorithm&amp;gt; ed25519 is recommended but some applications may not support this algorithm, I advise you to make an ed25519 key and an RSA key.
Newly acquired keys are located in your ~/.ssh directory.
~ ç«ˆé–€Â» ls ."/>
<meta name="keywords" content="linux, tutorials, programming, python"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/en/tuto/ssh-expert-tips/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSH Expert"/>
<meta name="twitter:description" content="All you need to know about SSH"/>



<meta property="og:title" content="SSH Expert" />
<meta property="og:description" content="All you need to know about SSH" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/en/tuto/ssh-expert-tips/" />
<meta property="article:published_time" content="2020-06-22T14:32:49+02:00" />
<meta property="article:modified_time" content="2020-06-22T14:32:49+02:00" /><meta property="og:site_name" content="RedFou52 - BlogPost" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">RedFou52 - BlogPost</span>
    <span class="logo__cursor"></span>
  
</a>


<ul class="nav-list">
    
    
        <a href="/fr/tuto/ssh-expert-tips/" style="text-decoration:none" >ðŸ‡«ðŸ‡·</a>
    
    
</ul>



    <span class="header__right">
      
        <nav class="menu">
	<ul class="menu__inner menu__inner--desktop">
    
      
        
	<li><a href="/en/tuto">Tutorials</a></li>
        
      
        
	<li><a href="/en/secu">Security</a></li>
        
      
        
	<li><a href="/en/raspberry">Raspberry</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
	      <li><a href="/en/nixos">NIXOS</a></li>
              
            
              
	      <li><a href="/en/arch">Archlinux</a></li>
              
            
              
	      <li><a href="/en/ml">MachineLearning</a></li>
              
            
              
	      <li><a href="/en/about">About</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/en/tuto">Tutorials</a></li>
      
    
      
        <li><a href="/en/secu">Security</a></li>
      
    
      
        <li><a href="/en/raspberry">Raspberry</a></li>
      
    
      
        <li><a href="/en/nixos">NIXOS</a></li>
      
    
      
        <li><a href="/en/arch">Archlinux</a></li>
      
    
      
        <li><a href="/en/ml">MachineLearning</a></li>
      
    
      
        <li><a href="/en/about">About</a></li>
      
    
  </ul>
</nav>


        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="/en/tuto/ssh-expert-tips/">SSH Expert</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-06-22
        </span>

        
      

      <span class="post-author">â€” Written by Eidorian</span>
      
    </div>

    

    
      
        <img src="/img/en/tuto/ssh/ssh-banner.png" class="post-cover" />
      
    

    <div class="post-content">
      
      <p>This tutorial is not going to teach you how to use SSH but more to show you some tips to improve your life.</p>
<hr>
<h1 id="keygen">Keygen</h1>
<pre><code class="language-bash/shell" data-lang="bash/shell"># generate Private and Public key
~ ç«ˆé–€Â» shh-keygen -t &lt;algorithm&gt;
</code></pre><p><code>ed25519</code> is recommended but some applications may not support this algorithm, I advise you to make an <code>ed25519</code> key and an <code>RSA</code> key.</p>
<p>Newly acquired keys are located in your <code>~/.ssh</code> directory.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">~ ç«ˆé–€Â» ls .ssh/   
id_ed25519  id_ed25519.pub  id_rsa  id_rsa.pub
</code></pre><p>Keep your private key to yourself. You can share your public key on other machines to log in without a password.</p>
<hr>
<h1 id="pubkeyauthentication">PubkeyAuthentication</h1>
<p>As we saw just before, you can share your public keys on other machines to log in without using a password.<br>
To do thta, you juste need to put your public_key into the <code>~/.ssh/autorized_keys</code> from the other machine.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell"># Simple way.  This is also the officially recommended method. 
~ ç«ˆé–€Â» ssh-copy-id -i ~/.ssh/id_rsa.pub &lt;user&gt;@&lt;IP&gt;

# The hardcore way
~ ç«ˆé–€Â» cat ~/.ssh/id_rsa.pub | ssh &lt;user&gt;@&lt;IP&gt; &quot;cat - &gt;&gt; ~/.ssh/authorized_keys&quot;
# It will require you to log in with the user once, after you don't need it anymore.
</code></pre><p>This option is enable by default at <code>/etc/ssh/sshd_config</code> :</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">#PubkeyAuthentication yes
</code></pre><h2 id="security-tips">Security tips</h2>
<p>It is recommended to use key logon and to disable password logon. Edit the <code>/etc/ssh/sshd_config</code> file.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell"># disable password auth
PasswordAuthentication no
# disable root login VERY IMPORTANT
PermitRootLogin no 
</code></pre><hr>
<h1 id="banners">Banners</h1>
<p>Putting up banners is a good practice when it comes to IT security. From a legal point of view, a server that displays &ldquo;WELCOME&rdquo; in large and bold letters will be much appreciated by an attacker as a warning message with some threat of legal action. Of course this will not change the security of the server but it is still a good idea to implement them.<br>
There are 2 types of banners</p>
<h2 id="post-login--issuenet">Post-login : issue.net</h2>
<p>This banner is located in <code>/etc/issue</code> or <code>/etc/issue.net</code>.<br>
The post banner can be enabled into the <code>/etc/ssh/ssgd_config</code> file.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">Banner /etc/issue.net
</code></pre><p>Anything you want to write in this file, any user not yet connected to your machine will see it.</p>
<pre><code>#Banner issue.net exemple
    &lt;hostname&gt;
***************************************************************************
                            NOTICE TO USERS

This computer system is the private property of its owner, whether
individual, corporate or government.  It is for authorized use only.
Users (authorized or unauthorized) have no explicit or implicit
expectation of privacy.

Any or all uses of this system and all files on this system may be
intercepted, monitored, recorded, copied, audited, inspected, and
disclosed to your employer, to authorized site, government, and law
enforcement personnel, as well as authorized officials of government
agencies, both domestic and foreign.

By using this system, the user consents to such interception, monitoring,
recording, copying, auditing, inspection, and disclosure at the
discretion of such personnel or officials.  Unauthorized or improper use
of this system may result in civil and criminal penalties and
administrative or disciplinary action, as appropriate. By continuing to
use this system you indicate your awareness of and consent to these terms
and conditions of use. LOG OFF IMMEDIATELY if you do not agree to the
conditions stated in this warning.

****************************************************************************

</code></pre><h2 id="after-login--motd">After-login : motd</h2>
<p>This banner is located at in <code>/etc/motd</code>.<br>
If you want to display a message after the login, you can put it there.</p>
<p>But, you can also display a lot of information about the machine in a script so this script can be executed and displayed after the login, you just need to create a file in <code>/etc/update-motd.d/</code> and put your script in that file :</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">~ ç«ˆé–€Â» cat /etc/update-motd.d/system_print
#!/bin/sh
figlet &quot;Nezuko&quot;
hostname=$(hostname)
ippub=$(wget -qO- http://ipecho.net/plain | xargs echo)

date=$('date')
echo &quot;########################################################&quot;
echo &quot;Informations:&quot;
echo &quot;Hostname    = &quot;$hostname
echo &quot;IP Publique = &quot;$ippub
echo &quot;IP PrivÃ©e   = 192.168.1.96&quot;
echo &quot;Date        = &quot;$date
echo &quot;-------------------------------------&quot;
#version=$(uname -s -o)
version=$(uname -v)
uptime=$(uptime | cut -d' ' -f4,5)
kernel=$(uname -r -o)
user=$(who | wc -l)
echo &quot;SystÃ¨me:&quot;
echo &quot;-Version OS = &quot;$version
echo &quot;-Uptime = &quot;$uptime
echo &quot;-Kernel = &quot;$kernel
echo &quot;-Utilisateurs = &quot;$user&quot; connectÃ©(s)&quot;
echo &quot;-------------------------------------&quot;
memused=$(free -m | grep 'Mem' | cut -c 28-32)
memtotal=$(free -m | grep 'Mem' | cut -c 15-20)
memfree=$(free -m | grep 'Mem' | cut -c 40-45)
echo &quot;MÃ©moire:&quot;
echo &quot;-Utilisation mÃ©moire   =&quot;$memused&quot;Mb sur &quot;$memtotal&quot;Mb soit &quot;$memfree&quot;Mb de libre.&quot;
echo &quot;-------------------------------------&quot;
use_swap=$(free -m | grep 'Swap' | cut -c 28-32)
use_root=$(df -h | grep -w / | awk '{print $5}')
use_home=$(df -h | grep -w /home | awk '{print $5}')
use_var=$(df -h | grep -w /var | awk '{print $5}')
use_tmp=$(df -h | grep -w /tmp | awk '{print $5}')
echo &quot;Disques:&quot;
echo &quot;-Utilisation du swap        = &quot;$use_swap&quot;Mb&quot;
echo &quot;-Utilisation du /           = &quot;$use_root&quot;&quot;
echo &quot;-Utilisation de /home       = &quot;$use_home&quot;&quot;
echo &quot;-Utilisation de /tmp        = &quot;$use_tmp&quot;&quot;
echo &quot;--------------------------------------&quot;
echo &quot;Fail2Ban:&quot;
check=$(cat /home/sanji/file/banip.txt)
echo $check
echo &quot;======================================&quot;
echo &quot;SSH logs:&quot;
sudo cat /var/log/auth.log | grep &quot;ssh&quot; | tail -n 5
echo &quot;======================================&quot;
echo &quot;Mise Ã  jour en attente :&quot;
echo &quot; &quot; $(apt list --upgradeable | sed 1d | cut -d'/' -f1)
echo &quot;=====================================&quot;
</code></pre><p><img src="/img/en/tuto/ssh/motd_1.png" alt="motd-update"></p>
<hr>
<h1 id="config-file">config file</h1>
<p>The config file is an alternative that will chnage your life in regards to the use of SSH !<br>
It&rsquo;s use is very simple, all the configuration is located in <code>~/.ssh/config</code>, there is an example here :</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">~ ç«ˆé–€Â» cat ~/.ssh/config 
Host senjuro
        hostname 192.168.1.90
        user root
        port 22

Host senjuro_d
        hostname 192.168.1.90
        user root
        port 4748

~ ç«ˆé–€Â» ssh senjuro
</code></pre><p>And your done, you can simply connect to your serber with this command.<br>
Add to this, au authentication without a password and you&rsquo;re done !</p>
<hr>
<h1 id="reverse-ssh-tunneling">Reverse SSH Tunneling</h1>
<p>This part is made with full knowledge of the facts, indeed, this command uses an SSH vulnerability and is a security hole if you use it at home or at work.<br>
BUT it can be very useful to know in order to access a server that doesn&rsquo;t have an open port with a Public IP.<br>
You can easly pass a firewall with this method.</p>
<p>First of all, you need to add these option into you sshd_config from your host_2.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell">root@host2 $ sed -i &quot;s/#AllowTcpForwrading yes/AllowTcpForwarding yes&quot; /etc/ssh/sshd_config
root@host2 $ sed -i &quot;s/#GatewayPorts no/GatewayPorts yes/&quot; /etc/ssh/sshd_config
</code></pre><p>Now you can start your Reverse SSH Tunneling.</p>
<pre><code class="language-bash/shell" data-lang="bash/shell"># You can't acces to your host from a Pub IP with host_2
# SO you need to init an SSH tunnel to host_2 and then
# Use this tunnel to acces your host.
~ ç«ˆé–€Â» cat ~/.ssh/config
host host_2
	hostname 82.64.30.30
	user root
	port 7222
# Execute this command from your host
~ ç«ˆé–€Â» ssh -NR 20013:localhost:22 host_2

# Execute this command from your host_2
root@host2 $ ssh -p 20013 root@127.0.0.1
</code></pre><p>If you want to close the connection, just close the first ssh from your host.</p>

    </div>
    


    
      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">@RedFou52 - Eidorian</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
